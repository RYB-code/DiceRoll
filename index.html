<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Roller</title>
    <style>
        /* Your CSS */
    </style>
</head>
<body>

    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQT8Be2A17SDMoWohdOUSYtb4o6SXsW3XLeWQ&s" alt="Logo" class="logo">
    <h1>Dice Roller</h1>
    <div class="dice-container">
        <div class="dice" id="dice1"></div>
    </div>

    <button class="roll-button" id="rollButton" onclick="rollDice()">Roll Dice</button>
    <div id="warning" class="warning">Only One Attempt!</div>
    <div class="history-container">
        <h2>History Log</h2>
        <div id="history" class="history">No rolls yet.</div>
    </div>

    <!-- User Info Form (Initially Hidden) -->
    <div id="formContainer" style="display: none;">
        <h2>Enter Your Details</h2>
        <input type="text" id="name" name="name" placeholder="Enter your name">
        <input type="text" id="phone" name="phone" placeholder="Enter your phone number">
        <button onclick="submitForm()">Submit</button>
    </div>

    <div id="congratulations" class="congratulations-ribbon">Congratulations!</div>
    <div id="fireworks" class="fireworks"></div>

    <script>
        let hasRolled = false;
        let historyLog = [];
        let userName = '';
        let userPhone = '';

        // Roll Dice Function
        function rollDice() {
            if (hasRolled) {
                return;
            }

            const dice1 = document.getElementById('dice1');
            const rollButton = document.getElementById('rollButton');
            const congratulationsRibbon = document.getElementById('congratulations');
            const fireworks = document.getElementById('fireworks');

            let roll1;

            // Dice roll simulation (5 seconds)
            let rollingTime = 5000; // 5 seconds
            let timer = setInterval(function() {
                roll1 = [1, 2, 3, 4, 5, 6][Math.floor(Math.random() * 6)];
                updateDiceDisplay(roll1);
            }, 100);

            // After 5 seconds, stop the dice roll
            setTimeout(function() {
                clearInterval(timer);
                roll1 = [1, 2, 3, 4, 5, 6][Math.floor(Math.random() * 6)];
                updateDiceDisplay(roll1);

                // Display Congratulations Ribbon
                congratulationsRibbon.style.display = 'block';
                setTimeout(function() {
                    congratulationsRibbon.style.display = 'none';
                }, 20000);

                // Trigger Fireworks
                triggerFireworks();

                // Record roll in history
                historyLog.push(`Roll: ${roll1}`);
                updateHistory();

                // Show the form after the roll
                document.getElementById('formContainer').style.display = 'block';

                // Save data to Google Sheets
                saveToGoogleSheets(userName, userPhone, roll1);

                // Disable the button and set flag
                hasRolled = true;
                rollButton.disabled = true;
            }, rollingTime);
        }

        // Update Dice Display with correct dot classes
        function updateDiceDisplay(roll) {
            const dice1 = document.getElementById('dice1');
            dice1.innerHTML = ''; // Clear the previous dots

            if (roll === 1) {
                dice1.innerHTML = '<div class="dot dot1"></div>';
            } else if (roll === 2) {
                dice1.innerHTML = '<div class="dot dot2"></div><div class="dot dot2-2"></div>';
            } else if (roll === 3) {
                dice1.innerHTML = '<div class="dot dot3-1"></div><div class="dot dot3-2"></div><div class="dot dot3-3"></div>';
            } else if (roll === 4) {
                dice1.innerHTML = '<div class="dot dot4"></div><div class="dot dot4-2"></div><div class="dot dot4-3"></div><div class="dot dot4-4"></div>';
            } else if (roll === 5) {
                dice1.innerHTML = '<div class="dot dot2"></div><div class="dot dot3"></div><div class="dot dot4"></div><div class="dot dot5"></div><div class="dot dot1"></div>';
            } else if (roll === 6) {
                dice1.innerHTML = '<div class="dot dot6-1"></div><div class="dot dot6-2"></div><div class="dot dot6-3"></div><div class="dot dot6-4"></div><div class="dot dot6-5"></div><div class="dot dot6-6"></div>';
            }
        }

        // Update History Log Display
        function updateHistory() {
            const historyElement = document.getElementById('history');
            historyElement.innerHTML = historyLog.join('<br>');
        }

        // Trigger Fireworks Effect
        function triggerFireworks() {
            const fireworksContainer = document.getElementById('fireworks');

            // Generate fireworks
            for (let i = 0; i < 10; i++) {
                const firework = document.createElement('div');
                firework.classList.add('firework');
                firework.style.left = Math.random() * 100 + '%';
                firework.style.animationDuration = (Math.random() * 10 + 10) + 's';
                fireworksContainer.appendChild(firework);
            }

            // Clear fireworks after animation
            setTimeout(function() {
                fireworksContainer.innerHTML = '';
            }, 50000);
        }

        // Function to save data to Google Sheets
        function saveToGoogleSheets(name, phone, roll) {
            const url = 'https://script.google.com/macros/s/AKfycbwwCuYXNgReQX9ZRO4hECvwVRUz0NbUChabTROyJFoQvL8as1TCfKd03qwMsLdZFi3q/exec';  // Your Apps Script URL
            const payload = {
                "name": name,
                "phone": phone,
                "roll": roll
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain' // Use text/plain to avoid preflight
                },
                body: JSON.stringify(payload),
                mode: 'no-cors' // Disable CORS
            })
            .then(() => {
                console.log('Data sent (response not accessible due to no-cors)');
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // Submit the form after roll is completed
        function submitForm() {
            userName = document.getElementById('name').value;
            userPhone = document.getElementById('phone').value;

            if (userName && userPhone) {
                // Hide the form after submission
                document.getElementById('formContainer').style.display = 'none';
                alert('Form submitted successfully!');
            } else {
                alert('Please fill in both fields!');
            }
        }
    </script>
</body>
</html>
